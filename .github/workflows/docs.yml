name: Build and Deploy Multilingual Documentation

on:
  push:
    branches: [main]
    paths:
      - 'source/**'
      - 'locales/**'
      - 'code/**'
      - 'Makefile'
      - 'requirements.txt'
  pull_request:
    branches: [main]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Setup Python 3.11
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    - name: Cache Python dependencies
      uses: actions/cache@v3
      with:
        path: ~/.cache/pip
        key: ${{ runner.os }}-pip-${{ hashFiles('requirements.txt') }}
        restore-keys: |
          ${{ runner.os }}-pip-
          
    - name: Install Python dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: Build all language versions
      run: |
        make all
        
    - name: Create index redirect page
      run: |
        cat > build/index.html << 'EOF'
        <!DOCTYPE html>
        <html>
        <head>
          <meta charset="utf-8">
          <title>Superhero Data Science - Choose Language</title>
          <meta name="viewport" content="width=device-width, initial-scale=1">
          <style>
            body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
                   text-align: center; padding: 50px; background: #f8f9fa; }
            .container { max-width: 600px; margin: 0 auto; }
            .language-links { display: flex; justify-content: center; gap: 20px; margin: 30px 0; }
            .lang-card { background: white; padding: 20px; border-radius: 8px; 
                        box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-decoration: none; color: inherit; }
            .lang-card:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
          </style>
        </head>
        <body>
          <div class="container">
            <h1>ğŸ¦¸ Superhero Data Science</h1>
            <p>Choose your preferred language / Scegli la tua lingua preferita / Choisissez votre langue prÃ©fÃ©rÃ©e</p>
            <div class="language-links">
              <a href="it/" class="lang-card">
                <h3>ğŸ‡®ğŸ‡¹ Italiano</h3>
                <p>Versione italiana</p>
              </a>
              <a href="en/" class="lang-card">
                <h3>ğŸ‡¬ğŸ‡§ English</h3>
                <p>English version</p>
              </a>
              <a href="fr/" class="lang-card">
                <h3>ğŸ‡«ğŸ‡· FranÃ§ais</h3>
                <p>Version franÃ§aise</p>
              </a>
            </div>
          </div>
        </body>
        </html>
        EOF
        
    - name: Deploy to GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      if: github.ref == 'refs/heads/main'
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./build
        # Optionally add custom domain:
        # cname: your-custom-domain.com
        
    # Optional: Add deployment status
    - name: Deployment Summary
      if: github.ref == 'refs/heads/main'
      run: |
        echo "ğŸš€ Documentation deployed successfully!"
        echo "ğŸ“ Available at:"
        echo "   - Main site: https://dariomalchiodi.github.io/sds/"
        echo "   - Custom domain: https://malchiodi.com/sds/"
        echo "   - Italian: https://malchiodi.com/sds/it/"
        echo "   - English: https://malchiodi.com/sds/en/"  
        echo "   - French:  https://malchiodi.com/sds/fr/"
